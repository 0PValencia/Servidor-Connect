<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Bolivia - Terra NASA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background-color: #f8fafc;
        }

        #map {
            width: 100vw;
            height: 100vh;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 250px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .controls h3 {
            margin-bottom: 15px;
            font-size: 16px;
            color: #1e293b;
            font-weight: 600;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(79, 70, 229, 0.3);
        }

        .control-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(79, 70, 229, 0.3);
            border: none;
        }

        .control-group .value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            color: #4f46e5;
        }

        .toggle-btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2);
        }

        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(79, 70, 229, 0.3);
        }

        .dept-popup {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            z-index: 2000;
            min-width: 320px;
            max-width: 400px;
            display: none;
            animation: popupAppear 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes popupAppear {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .dept-popup.active {
            display: block;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4f46e5;
        }

        .popup-header h3 {
            color: #1e293b;
            font-size: 20px;
            margin: 0;
            font-weight: 700;
        }

        .popup-close {
            background: #ef4444;
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .popup-close:hover {
            background: #dc2626;
            transform: rotate(90deg);
        }

        .coordinates-box {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
        }

        .coordinates-box h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
            opacity: 0.9;
            font-weight: 600;
        }

        .coord-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 13px;
        }

        .coord-label {
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-huella {
            background: linear-gradient(135deg, #ef4444, #f97316);
            color: white;
        }

        .btn-huella:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-trivia {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-trivia:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(16, 185, 129, 0.3);
        }

        .trivia-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            animation: fadeIn 0.3s ease;
        }

        .trivia-modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .trivia-container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .trivia-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #4f46e5;
        }

        .trivia-header h3 {
            color: #1e293b;
            font-size: 24px;
            font-weight: 700;
        }

        .close-btn {
            background: #ef4444;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #dc2626;
            transform: rotate(90deg);
        }

        .trivia-question {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
            border-left: 4px solid #4f46e5;
        }

        .trivia-question h4 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
        }

        .trivia-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .trivia-option {
            padding: 12px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .trivia-option:hover {
            border-color: #4f46e5;
            background: #f0f9ff;
            transform: translateX(5px);
        }

        .trivia-option.correct {
            background: #dcfce7;
            border-color: #22c55e;
        }

        .trivia-option.incorrect {
            background: #fef2f2;
            border-color: #ef4444;
        }

        .trivia-option.disabled {
            pointer-events: none;
            opacity: 0.6;
        }

        .trivia-score {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
        }

        .huella-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            animation: fadeIn 0.3s ease;
        }

        .huella-modal.active {
            display: flex;
        }

        .huella-form-container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 25px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
        }

        .huella-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ef4444;
        }

        .huella-form-header h3 {
            color: #1e293b;
            font-size: 24px;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            background: #f8fafc;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4f46e5;
            background: white;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-group input::placeholder {
            color: #9ca3af;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .btn-submit {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #ef4444, #f97316);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(239, 68, 68, 0.2);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-cancel {
            flex: 1;
            padding: 12px;
            background: #6b7280;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(107, 114, 128, 0.2);
        }

        .btn-cancel:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .form-info {
            background: #eff6ff;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        #boliviaOverlay path {
            fill: rgba(79, 70, 229, 0.3);
            stroke: #ffffff;
            stroke-width: 2;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        #boliviaOverlay path:hover {
            fill: rgba(249, 115, 22, 0.5);
            stroke: #f97316;
            stroke-width: 3;
        }

        #boliviaOverlay path.selected {
            fill: rgba(239, 68, 68, 0.6);
            stroke: #ef4444;
            stroke-width: 3;
        }

        #boliviaOverlay path.visitado {
            fill: rgba(34, 197, 94, 0.5);
            stroke: #22c55e;
        }

        /* Estilos para los iconos de huella - AHORA M√ÅS PEQUE√ëOS */
        .huella-icon {
            background: #ef4444;
            border: 2px solid white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .huella-icon:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.5);
        }

        .leaflet-tooltip {
            background: rgba(0, 0, 0, 0.8);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 12px;
            padding: 6px 10px;
        }

        .leaflet-tooltip-top::before {
            border-top-color: rgba(0, 0, 0, 0.8);
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="controls">
        <h3>Controles de Capa</h3>
        
        <div class="control-group">
            <label>Opacidad SVG: <span class="value" id="opacityValue">60%</span></label>
            <input type="range" id="opacitySlider" min="0" max="100" value="60">
        </div>
        
        <div class="control-group">
            <label>Grosor de Borde: <span class="value" id="strokeValue">2px</span></label>
            <input type="range" id="strokeSlider" min="0.5" max="5" step="0.5" value="2">
        </div>
        
        <button class="toggle-btn" id="toggleLayer">Ocultar Capa SVG</button>
    </div>

    <div class="dept-popup" id="deptPopup"></div>

    <div class="trivia-modal" id="triviaModal">
        <div class="trivia-container" id="triviaContainer"></div>
    </div>

    <div class="huella-modal" id="huellaModal">
        <div class="huella-form-container">
            <div class="huella-form-header">
                <h3>üë£ Dejar tu Huella</h3>
                <button class="close-btn" onclick="closeHuellaForm()">√ó</button>
            </div>
            <div class="form-info">
                üìç Est√°s dejando tu huella en: <strong id="deptName"></strong>
            </div>
            <form id="huellaForm" onsubmit="submitHuella(event)">
                <div class="form-group">
                    <label for="userNick">Nick o Nombre *</label>
                    <input type="text" id="userNick" name="nick" placeholder="Ej: Viajero123" required>
                </div>
                <div class="form-group">
                    <label for="userEmail">Correo Electr√≥nico *</label>
                    <input type="email" id="userEmail" name="email" placeholder="tucorreo@ejemplo.com" required>
                </div>
                <div class="form-buttons">
                    <button type="button" class="btn-cancel" onclick="closeHuellaForm()">Cancelar</button>
                    <button type="submit" class="btn-submit">‚úì Dejar Huella</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script>
        const API_BASE = 'http://localhost:3001/api';
        const triviaData = {
            'Beni': [
                {
                    pregunta: 'Seg√∫n MODIS de NASA, en 2023 se detectaron cicatrices de quema extensas en Beni. ¬øCu√°l fue la causa principal?',
                    opciones: ['Incendios naturales', 'Incendios agr√≠colas y deforestaci√≥n', 'Actividad volc√°nica', 'Sequ√≠a extrema'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra MODIS observa que Beni tiene mayor proporci√≥n de qu√© tipo de fuego comparado con Santa Cruz?',
                    opciones: ['Fuegos forestales destructivos', 'Fuegos de pastizales menos da√±inos', 'Fuegos urbanos', 'No hay fuegos'],
                    correcta: 1
                },
                {
                    pregunta: 'MODIS detecta humo sobre Beni desde septiembre 2022. ¬øDe d√≥nde proviene principalmente?',
                    opciones: ['Industrias', 'Incendios forestales y agr√≠colas', 'Volcanes', 'Tormentas de polvo'],
                    correcta: 1
                },
                {
                    pregunta: 'Los sat√©lites NASA detectan en Beni desde agosto 2020 fuegos a lo largo de qu√© carretera?',
                    opciones: ['Carretera 1', 'Carretera 7', 'Carretera 13', 'Carretera 20'],
                    correcta: 2
                },
                {
                    pregunta: 'Terra observa que los Llanos de Moxos en Beni experimentan inundaciones estacionales. ¬øCu√°ndo ocurren?',
                    opciones: ['Junio-Agosto', 'Diciembre-Febrero', 'Marzo-Mayo', 'Septiembre-Noviembre'],
                    correcta: 2
                }
            ],
            'Santa Cruz': [
                {
                    pregunta: 'Im√°genes Landsat desde 1986 muestran en Santa Cruz un patr√≥n caracter√≠stico de deforestaci√≥n. ¬øCu√°l?',
                    opciones: ['L√≠neas paralelas', 'Formas de rueda de carreta radiales y rectangulares', 'C√≠rculos conc√©ntricos', 'Sin patr√≥n'],
                    correcta: 1
                },
                {
                    pregunta: 'Datos satelitales 2001-2021 revelan que la deforestaci√≥n en Santa Cruz fue causada principalmente por cultivo de:',
                    opciones: ['Caf√©', 'Soja (m√°s de 900,000 hect√°reas)', 'Arroz', 'Trigo'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra detecta que Santa Cruz sufri√≥ deforestaci√≥n de 161,000 hect√°reas en un a√±o reciente. ¬øCu√°l fue la causa?',
                    opciones: ['Miner√≠a', 'Agricultura', 'Urbanizaci√≥n', 'Turismo'],
                    correcta: 1
                },
                {
                    pregunta: 'MODIS muestra que el bosque seco de Chiquitan√≠a en Santa Cruz ha sido transformado desde los a√±os 70 por:',
                    opciones: ['Glaciares', 'Agricultura y asentamientos humanos', 'Erupciones volc√°nicas', 'Erosi√≥n natural'],
                    correcta: 1
                },
                {
                    pregunta: 'Sat√©lites detectan que los fuegos en Santa Cruz fueron intensos. ¬øCu√°ntos focos se registraron en dos semanas de 2019?',
                    opciones: ['1,000', '5,000', 'M√°s de 15,600', '500'],
                    correcta: 2
                }
            ],
            'La Paz': [
                {
                    pregunta: 'MODIS captura la ciudad de La Paz en una depresi√≥n √∫nica. ¬øA qu√© altitud aproximada est√° el centro?',
                    opciones: ['2,500 msnm', '3,650 msnm', '4,500 msnm', '5,000 msnm'],
                    correcta: 1
                },
                {
                    pregunta: 'El sat√©lite Terra detecta el Lago Titicaca cerca de La Paz. ¬øQu√© caracter√≠stica especial tiene?',
                    opciones: ['Lago m√°s grande del mundo', 'Lago navegable m√°s alto del mundo', 'Lago m√°s profundo', 'Lago de agua salada'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra observa el retroceso glaciar en monta√±as de La Paz desde 2000. ¬øCu√°nto han retrocedido aproximadamente?',
                    opciones: ['5-10%', '15-25%', '40-50%', '70%'],
                    correcta: 2
                },
                {
                    pregunta: 'Im√°genes de Terra muestran el Nevado Illimani dominando el paisaje de La Paz. ¬øQu√© altura tiene?',
                    opciones: ['5,200 m', '5,800 m', '6,438 m', '7,000 m'],
                    correcta: 2
                },
                {
                    pregunta: 'MODIS detecta que el √°rea urbana de La Paz tiene una forma caracter√≠stica visible desde el espacio:',
                    opciones: ['C√≠rculo perfecto', 'Extendida en ca√±√≥n/valle profundo', 'Cuadr√≠cula regular', 'Espiral'],
                    correcta: 1
                }
            ],
            'Cochabamba': [
                {
                    pregunta: 'Terra detecta diferentes zonas clim√°ticas en Cochabamba. ¬øCu√°ntas zonas principales se observan?',
                    opciones: ['2 zonas', '3 zonas', '4 zonas', '5 zonas'],
                    correcta: 1
                },
                {
                    pregunta: 'MODIS muestra que Cochabamba tiene valles productivos. ¬øQu√© indica el color rojo en infrarrojo?',
                    opciones: ['Agua abundante', 'Vegetaci√≥n activa', 'Nieve', 'Suelo desnudo'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra registra que la regi√≥n del Chapare en Cochabamba tiene alta cobertura vegetal. ¬øA qu√© ecosistema pertenece?',
                    opciones: ['Altiplano andino', 'Selva amaz√≥nica', 'Valle interandino', 'Puna seca'],
                    correcta: 1
                },
                {
                    pregunta: 'Los datos satelitales muestran que Cochabamba est√° a una altura promedio de:',
                    opciones: ['1,500 msnm', '2,570 msnm', '3,500 msnm', '4,000 msnm'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra detecta frecuentes incendios forestales en ciertas √©pocas. ¬øCu√°ndo ocurren principalmente?',
                    opciones: ['√âpoca de lluvias', '√âpoca seca (agosto-octubre)', 'Todo el a√±o igual', 'Solo en invierno'],
                    correcta: 1
                }
            ],
            'Chuquisaca': [
                {
                    pregunta: 'Terra MODIS detecta en Chuquisaca una transici√≥n entre two biomas importantes. ¬øCu√°les son?',
                    opciones: ['Desierto y oc√©ano', 'Andes y Chaco', 'Amazon√≠a y Pampa', 'Tundra y bosque'],
                    correcta: 1
                },
                {
                    pregunta: 'Las im√°genes satelitales muestran que Sucre tiene tejados de color claro visibles desde el espacio. ¬øPor qu√©?',
                    opciones: ['Arquitectura colonial', 'Nieve permanente', 'Paneles solares', 'Arena del desierto'],
                    correcta: 0
                },
                {
                    pregunta: 'Terra observa el Parque Nacional Torotoro en Chuquisaca con formaciones √∫nicas. ¬øQu√© se detecta?',
                    opciones: ['Volcanes activos', 'Ca√±ones y cavernas', 'Dunas de arena', 'Lagos salados'],
                    correcta: 1
                },
                {
                    pregunta: 'Los datos de Terra indican que Chuquisaca tiene un clima:',
                    opciones: ['Tropical h√∫medo', 'Templado a seco', 'Polar', 'Des√©rtico extremo'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra detecta huellas de dinosaurios en Torotoro visibles desde el espacio por:',
                    opciones: ['Su gran tama√±o', 'El contraste de color en la roca', 'La vegetaci√≥n diferente', 'Lagos formados'],
                    correcta: 1
                }
            ],
            'Pando': [
                {
                    pregunta: 'Terra MODIS muestra que Pando es el departamento con mayor cobertura de:',
                    opciones: ['Desierto', 'Selva amaz√≥nica virgen', 'Praderas', 'Monta√±as nevadas'],
                    correcta: 1
                },
                {
                    pregunta: 'Las im√°genes satelitales detectan que Pando limita con dos pa√≠ses. ¬øCu√°les son?',
                    opciones: ['Chile y Argentina', 'Per√∫ y Brasil', 'Paraguay y Argentina', 'Colombia y Venezuela'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra registra que la principal actividad econ√≥mica visible desde el espacio en Pando es:',
                    opciones: ['Miner√≠a a cielo abierto', 'Recolecci√≥n de casta√±a', 'Agricultura intensiva', 'Pesca industrial'],
                    correcta: 1
                },
                {
                    pregunta: 'Los datos de deforestaci√≥n de Terra muestran que Pando tiene:',
                    opciones: ['La tasa m√°s alta de Bolivia', 'Una de las tasas m√°s bajas de Bolivia', 'No hay bosques', 'Deforestaci√≥n total'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra detecta que el clima de Pando es:',
                    opciones: ['Fr√≠o y seco', 'Tropical h√∫medo con lluvias abundantes', 'Templado', 'Polar'],
                    correcta: 1
                }
            ],
            'Oruro': [
                {
                    pregunta: 'Terra MODIS captur√≥ el Salar de Coipasa en Oruro. ¬øQu√© caracter√≠stica √∫nica tiene visible desde el espacio?',
                    opciones: ['Es completamente negro', 'Refleja mucha luz solar', 'Tiene forma de estrella', 'Est√° cubierto de nieve'],
                    correcta: 1
                },
                {
                    pregunta: 'Las im√°genes muestran el Nevado Sajama en Oruro. ¬øQu√© representa?',
                    opciones: ['El volc√°n m√°s activo', 'La monta√±a m√°s alta de Bolivia (6,542m)', 'El glaciar m√°s grande', 'El cr√°ter m√°s profundo'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra detecta que Oruro est√° ubicado en:',
                    opciones: ['La selva amaz√≥nica', 'El Altiplano boliviano', 'Los valles', 'La costa'],
                    correcta: 1
                },
                {
                    pregunta: 'Los datos de Terra muestran que el Lago Poop√≥ en Oruro:',
                    opciones: ['Est√° creciendo', 'Se ha reducido dram√°ticamente', 'Est√° congelado', 'No existe'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra observa actividad minera en Oruro principalmente de:',
                    opciones: ['Diamantes', 'Oro', 'Esta√±o y otros minerales', 'Carb√≥n'],
                    correcta: 2
                }
            ],
            'Potos√≠': [
                {
                    pregunta: 'Terra captur√≥ el Salar de Uyuni en Potos√≠, el m√°s grande del mundo. ¬øQu√© extensi√≥n tiene?',
                    opciones: ['5,000 km¬≤', '10,582 km¬≤', '15,000 km¬≤', '20,000 km¬≤'],
                    correcta: 1
                },
                {
                    pregunta: 'Las im√°genes de Terra muestran que el Cerro Rico de Potos√≠ tiene un color distintivo por:',
                    opciones: ['La nieve permanente', 'La oxidaci√≥n de minerales', 'La vegetaci√≥n roja', 'El suelo volc√°nico'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra MODIS detecta que Potos√≠ es una de las ciudades m√°s altas del mundo. ¬øA qu√© altura est√°?',
                    opciones: ['2,500 msnm', '3,500 msnm', '4,070 msnm', '5,000 msnm'],
                    correcta: 2
                },
                {
                    pregunta: 'Los datos satelitales muestran que el Salar de Uyuni contiene grandes reservas de:',
                    opciones: ['Petr√≥leo', 'Litio', 'Oro', 'Uranio'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra observa en el Salar de Uyuni formaciones hexagonales. ¬øQu√© son?',
                    opciones: ['Cr√°teres de meteoritos', 'Patrones de cristalizaci√≥n de sal', 'Construcciones humanas', 'Formaciones de hielo'],
                    correcta: 1
                }
            ],
            'Tarija': [
                {
                    pregunta: 'Terra MODIS detecta que Tarija tiene valles productivos. ¬øQu√© cultivo es m√°s visible desde el espacio?',
                    opciones: ['Arroz', 'Vi√±edos', 'Trigo', 'Caf√©'],
                    correcta: 1
                },
                {
                    pregunta: 'Las im√°genes satelitales muestran que Tarija limita con dos pa√≠ses. ¬øCu√°les?',
                    opciones: ['Brasil y Per√∫', 'Argentina y Paraguay', 'Chile y Per√∫', 'Paraguay y Brasil'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra observa la Represa de San Jacinto en Tarija. ¬øQu√© prop√≥sito tiene?',
                    opciones: ['Turismo', 'Generaci√≥n hidroel√©ctrica y riego', 'Pesca comercial', 'Navegaci√≥n'],
                    correcta: 1
                },
                {
                    pregunta: 'Los datos satelitales muestran que Tarija tiene un clima:',
                    opciones: ['Tropical h√∫medo', 'Templado mediterr√°neo', 'Polar', 'Des√©rtico'],
                    correcta: 1
                },
                {
                    pregunta: 'Terra detecta en Tarija la transici√≥n entre:',
                    opciones: ['Selva y desierto', 'Valles andinos y Chaco', 'Monta√±a y oc√©ano', 'Altiplano y amazon√≠a'],
                    correcta: 1
                }
            ]
        };

        let visitedDepartments = {};
        let map;
        let currentDepartment = null;
        let currentClickCoords = null;
        let huellaMarkers = [];
        let huellaData = [];
        let huellaLayerGroup;

        document.addEventListener('DOMContentLoaded', function() {
            map = L.map('map').setView([-16.5, -64.5], 6);

            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri',
                maxZoom: 18
            }).addTo(map);

            // Crear grupo de capas para las huellas
            huellaLayerGroup = L.layerGroup().addTo(map);

            const svgElement = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svgElement.setAttribute('id', 'boliviaOverlay');
            svgElement.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
            svgElement.setAttribute('viewBox', '0 0 614 694');
            
            svgElement.innerHTML = `
                <path id="Beni" data-name="Beni" d="M145.82 310.4L131.84 296.27L130.15 295.65L129.41 294.8L128.87 293.43L128.5 287.83L121.47 275.88L120.49 274.89L116.84 274.85L114.09 272.91L113.13 270.4L113.06 268.47L114.04 263.67L113.66 261.24L108.92 256.43L107.48 251.99L107.6 245.96L106.66 238.15L108.57 232.87L107.78 222.65L109.8 210.69L111.23 207.03L112.82 206.28L117.35 200.07L117.22 198.88L115.82 198.09L114.7 192.06L115.16 190.54L118.33 185.84L120.54 184.65L127.23 176.25L132.29 172.18L136.91 157.07L138.09 151.65L137.31 147.86L137.84 139.74L138.46 138.94L139.26 138.19L139.95 136.71L139.27 133.59L139.96 128.9L141.49 123.93L141.62 122.31L140.1 117.6L138.46 114.63L139.3 106.55L139.95 105.44L146.81 103.23L149.34 101.05L148.92 97.83L150.06 92.53L151.09 90.96L154.51 90.2L162.16 90.28L169.15 86.44L170.32 85.47L171.69 83.25L171.57 81.9L177.19 73.76L181.38 66.61L182.97 61.6L182.11 60.88L180.36 60.77L184.22 57.76L185.71 57.65L188.72 58.36L197.25 52.42L202.62 46.21L209.14 42.24L211.79 38.65L212.76 37.86L215.86 37.35L216.09 38.38L215.53 39.83L213.53 41.42L213.73 48.83L216.15 55.82L219.89 62.19L220.56 67.54L215.55 76.94L216.12 82.3L218.26 88.95L220.17 93.52L221.21 94.07L223.64 94.12L224.58 94.78L227.28 99.69L225.27 104.65L226.15 106.71L228.28 107.74L229.85 104L232.68 106.86L233.64 109.67L234.97 117.87L235.4 118.87L236.61 119.98L245.43 120.88L246.36 121.54L249.01 127.1L255.11 130.22L260.21 131.82L261.19 138.19L265 142.03L267.44 143.42L271.46 144.13L274.21 143.98L277.36 144.31L284.26 145.97L285.25 146.95L289.89 147.48L291.37 146.52L292.78 144.73L296.47 143L302.8 143.54L312.91 148.66L313.27 149.97L315.73 152.95L320.3 155.53L324.23 155.62L325.79 154.34L329.96 152.02L333.3 153.26L334.21 157.76L336.98 162.48L341.9 165.61L348.3 171.04L352.41 169.12L354.55 171.12L354.57 172.4L367.72 178.24L373.58 177.99L374.78 177.25L376.34 176.96L381.39 178.65L382.81 184.7L386.99 189.38L388.48 190.06L393.47 194.11L393.75 195.49L395.17 198.48L396.7 198.99L407.62 196.85L307.07 254.79L287.81 260.15L288.44 261.58L289.53 266.36L288.49 277.89L289.62 281.94L292.97 289.38L302.56 304.1L305.17 306.68L312.16 310.44L314.34 313.76L317.83 320.71L316.4 321.56L260.93 319.29L255.81 318.96L251.78 318.04L246.78 318.94L226.35 321.32L221.88 330.3L222.35 332.25L219.82 339.89L218.94 341.87L217.96 342.82L213.51 345.13L205.87 347.51L195.29 350.41L191.67 350.47L185.61 349.25L180.7 347.5L173.29 342.63L163.38 331.67L161.94 329.65L160.31 325.03L157.99 322.11L145.82 310.4Z"/>
                <path id="Cochabamba" data-name="Cochabamba" d="M153.87 430.43L149.91 421.43L144.83 414.68L142.06 412L135.46 407.27L143.43 403.08L140.35 387.53L133.66 377.51L137.63 369.72L139.96 369.28L143.83 369.17L145.69 368.49L146.52 367.69L147.54 365.81L148.65 358.56L148.79 356.39L147.2 353.42L146.1 346.86L145.69 341.7L140.98 332.76L139.33 330.93L139.08 317.29L139.66 315.88L141.74 313.52L145.82 310.4L157.99 322.11L160.31 325.03L161.94 329.65L163.38 331.67L173.29 342.63L180.7 347.5L185.61 349.25L191.67 350.47L195.29 350.41L205.87 347.51L213.51 345.13L217.96 342.82L218.94 341.87L219.82 339.89L222.35 332.25L221.88 330.3L226.35 321.32L246.78 318.94L251.78 318.04L250.62 321.49L250.95 325.88L252.02 328.87L252.98 334.27L254.02 345.36L250.99 353.96L248.58 358.02L246.67 362.85L246.86 367.28L247.46 369.21L251.1 376.48L266.64 386.63L269.14 388.63L274.86 395.58L275.38 396.64L275.15 400.38L268.99 400.41L266 402.67L265.96 405.24L265.23 406.72L257.13 418.49L253.78 421.99L250.81 424.43L250.41 425.59L250.55 427.37L254.2 431.41L262.01 444.12L264.75 452.87L265.5 453.64L267 454.19L270.92 457.27L271.5 462.36L268.93 466.04L267.3 463.14L265.24 463.25L263.31 465.32L260.1 466.4L258.32 466.41L254.62 464.4L251.34 459.2L245.5 457.07L242.17 457.01L239.58 458.18L234.66 461.8L232.89 463.82L233.33 465.28L233.24 466.61L226.66 463.53L223.57 461.6L223.02 459.1L218.29 453.23L211.73 448.12L207.33 443.27L203.43 438.06L200.17 434.96L195.1 431.27L191.57 429.6L188.81 430.22L185.85 426.82L184.43 424.11L183.42 423.55L180.44 423.14L176.09 424.06L168.12 430.19L166.5 430.45L162.4 429.99L153.87 430.43Z"/>
                <path id="Chuquisaca" data-name="Chuquisaca" d="M223.89 619.34L219.11 615.39L213.17 609.37L211.87 606.59L211.7 604.84L212.1 594.98L213.66 590.25L214.31 582.38L216.88 574.96L220.12 568.38L220.88 565.47L217.31 551.17L217.15 548.1L219.64 539.27L224.29 536.46L228.79 535.65L232.04 535.5L233.92 534.97L241.03 531.05L246.52 525.67L249.15 521.83L245.81 516.8L244.41 512L244.6 509.68L242.84 505.39L239.98 502.91L236.18 502.59L234.91 502.93L233.43 503.92L228.5 503.7L220.65 500.1L216.64 497.4L216.15 495.77L209.7 487.96L208.59 484.6L210.66 480.4L210.22 473.95L214.19 470.1L214.56 468.97L214.45 467.91L213.51 467.05L205.19 465.64L203.95 458.79L201.91 453.9L202.31 449.78L212.99 452.39L217.13 453.74L218.29 453.23L223.02 459.1L223.57 461.6L226.66 463.53L233.24 466.61L233.33 465.28L232.89 463.82L234.66 461.8L239.58 458.18L242.17 457.01L245.5 457.07L251.34 459.2L254.62 464.4L258.32 466.41L260.1 466.4L263.31 465.32L265.24 463.25L267.3 463.14L268.93 466.04L270.2 466.85L270.33 470.35L272.05 474.68L283.86 488.02L285.98 492.69L288.24 493.12L289.31 492.9L290.3 492.01L290.96 490.72L291.24 486.88L292.01 485.98L299.3 486.08L297.92 497.23L299.83 523.05L299.91 534.09L301.45 538.29L301.9 542.09L301.85 546.23L302.65 560.27L303.49 560.97L311.12 561.62L315.59 558.61L322.07 562.32L377.09 562.12L373.53 566.98L373.95 590.48L335.17 590.65L287.43 590.33L284.11 587.98L282.74 586.06L277.44 584.64L276.91 586.01L277.01 591.72L276.21 596.38L275.52 597.57L274.52 598.22L267.9 597.73L261.3 595.07L257.4 591.56L253.66 587.35L250.26 586.74L248.4 589.68L248.03 592.28L246.92 594.86L244.3 595.41L242.38 594.48L240.24 592.26L231.89 588L227.75 587.51L226.98 589.08L223.89 619.34Z"/>
                <path id="LaPaz" data-name="La Paz" d="M145.82 310.4L141.74 313.52L139.66 315.88L139.08 317.29L139.33 330.93L140.98 332.76L145.69 341.7L146.1 346.86L147.2 353.42L148.79 356.39L148.65 358.56L147.54 365.81L146.52 367.69L145.69 368.49L143.83 369.17L139.96 369.28L137.63 369.72L133.66 377.51L140.35 387.53L143.43 403.08L135.46 407.27L132.76 404.35L130.63 400.74L129.36 399.64L127.93 399.31L125.99 399.65L119.7 401.69L112.66 405.79L106.81 410.28L96.94 416.64L96.85 417.98L97.8 419.71L97.97 421.36L97.06 423.05L95.68 423.73L94.02 423.47L83.66 415.74L76.81 412.7L74.76 412.23L67.6 412.11L61.37 412.7L57.98 414.03L54.88 416.04L49.08 423.17L43.19 427.87L40.09 429.44L33.96 431.02L30.31 432.88L27.35 432.41L19.41 429.8L18.19 427.04L17.88 425.19L18.02 421.67L16.16 417.48L9.52 411.56L8.89 404.85L8.82 398.21L4.3 393.82L1 393.39L2.88 389.59L7.29 385.14L13.6 382.11L14.58 381.1L17.92 374.46L24.41 366.7L28.67 363.22L33.47 360.36L33.37 358.92L32.48 357.83L32.01 354.65L32.37 350.75L34.56 347.96L42.5 344.53L42.96 343.08L42.24 341.62L39.49 340.85L35.7 336.96L31.84 336.89L30.53 337.92L27.03 337.65L26.04 337.1L23.31 334.25L12.86 306.34L17.32 296.84L20.56 291.02L24.21 287.63L25.53 287.71L26.88 287.25L27.18 285.86L24.12 282.27L19.22 278.16L14.86 272.21L15.7 263.7L16.77 262.62L18.43 261.96L21.54 257.84L21.75 254.15L22.22 252.73L34.89 241.82L34.1 239.64L33.97 235.13L34.78 234.25L41.26 232.62L39.21 223.92L36.06 221.61L35.35 220.53L33.38 211.49L30.93 207.19L35.14 199.89L36.05 196.83L36.08 184.76L35.69 179.28L35.94 172.11L35.44 170.84V163.82L40.17 158.27L43.4 157.02L47.02 149.4L50.54 145.11L52.32 144.98L60.43 140.88L62.49 137.58L64 133.05L65.94 131.36L69.61 129.1L70.14 127.98L70.05 123.39L70.41 122.03L71.29 121.02L73.49 119.84L82.37 117.12L84.68 115.72L85.45 114.35L123.16 131.25L138.46 138.94L137.84 139.74L137.31 147.86L138.09 151.65L136.91 157.07L132.29 172.18L127.23 176.25L120.54 184.65L118.33 185.84L115.16 190.54L114.7 192.06L115.82 198.09L117.22 198.88L117.35 200.07L112.82 206.28L111.23 207.03L109.8 210.69L107.78 222.65L108.57 232.87L106.66 238.15L107.6 245.96L107.48 251.99L108.92 256.43L113.66 261.24L114.04 263.67L113.06 268.47L113.13 270.4L114.09 272.91L116.84 274.85L120.49 274.89L121.47 275.88L128.5 287.83L128.87 293.43L129.41 294.8L130.15 295.65L131.84 296.27L145.82 310.4Z"/>
                <path id="Pando" data-name="Pando" d="M50.54 145.11L37.86 119.32L5.43 65.78H9.54L13.3 65.1L30.25 66.6L41.71 69.1L46.1 68.44L45.86 75.28L49.19 75.15L55.45 73.54L58.17 71.3L64.23 69.18L67.18 68.63L70.36 67.24L78.24 55.99L78.53 54.6L79.38 53.24L81.44 51.77L83.64 50.94L91.29 50.77L93.73 51.2L97.52 53.63L99.49 52.7L100.92 48.89L104.21 44.31L105.58 43L112.29 39.8L118.48 35.59L118.65 33.78L123.59 33.19L125.72 33.79L131.08 30.99L140.32 21.97L147.05 16.85L152.14 14.7L153.59 12.52L161.22 11.3L163.35 11.65L176.56 7L181.48 5.9L186.81 6.11L198.21 5.64L205.26 8.92L207.11 8.93L209.81 5.82L209.99 4.16L213.52 1L215.3 1.36L216.81 2.23L220.6 9.29L218.85 14.62L219.16 19.55L220.5 22.45L221.24 28.4L220.11 32.01L216.75 35.38L215.86 37.35L212.76 37.86L211.79 38.65L209.14 42.24L202.62 46.21L197.25 52.42L188.72 58.36L185.71 57.65L184.22 57.76L180.36 60.77L182.11 60.88L182.97 61.6L181.38 66.61L177.19 73.76L171.57 81.9L171.69 83.25L170.32 85.47L169.15 86.44L162.16 90.28L154.51 90.2L151.09 90.96L150.06 92.53L148.92 97.83L149.34 101.05L146.81 103.23L139.95 105.44L139.3 106.55L138.46 114.63L140.1 117.6L141.62 122.31L141.49 123.93L139.96 128.9L139.27 133.59L139.95 136.71L139.26 138.19L138.46 138.94L123.16 131.25L85.45 114.35L84.68 115.72L82.37 117.12L73.49 119.84L71.29 121.02L70.41 122.03L70.05 123.39L70.14 127.98L69.61 129.1L65.94 131.36L64 133.05L62.49 137.58L60.43 140.88L52.32 144.98L50.54 145.11Z"/>
                <path id="Oruro" data-name="Oruro" d="M30.31 432.88L33.96 431.02L40.09 429.44L43.19 427.87L49.08 423.17L54.88 416.04L57.98 414.03L61.37 412.7L67.6 412.11L74.76 412.23L76.81 412.7L83.66 415.74L94.02 423.47L95.68 423.73L97.06 423.05L97.97 421.36L97.8 419.71L96.85 417.98L96.94 416.64L106.81 410.28L112.66 405.79L119.7 401.69L125.99 399.65L127.93 399.31L129.36 399.64L130.63 400.74L132.76 404.35L135.46 407.27L142.06 412L144.83 414.68L149.91 421.43L153.87 430.43L153.14 431.96L148.88 433.43L148.01 434.24L147.51 438.85L147.79 441.14L148.76 442.41L151.8 443.65L154.85 443.19L158.78 444.12L158.34 445.31L156.26 446.59L154.4 447.25L151.17 449.52L150.5 456.7L152.75 461.79L153.61 462.95L158.87 467.27L164.57 469.46L167.28 469.55L170.11 470.47L171.51 471.61L173.92 479.03L175.35 482.27L177.69 485.69L183.22 492.12L183.39 493.2L182.52 494.38L181.09 494.8L170.34 495.69L166.83 495.6L163.38 496.18L159.36 498.5L152.41 505.07L150.26 506.47L107.12 525.34L100.24 528.25L98.35 528.59L84.2 523.54L68.11 518.4L55.65 513.84L62.15 506.77L59.73 503.33L56.73 500.69L52.14 498.71L45.06 491.27L39.14 487.18L35.82 481.26L37.48 477.53L34.07 470.13L32.86 465.66L32.45 460.45L32.91 456.4L32.09 454.16L30.33 451.58L29.51 442.92L27.26 440.36L26.58 438.83L27.05 437.48L29.94 435.47L30.4 434.49L30.31 432.88Z"/>
                <path id="Potosi" data-name="Potos√≠" d="M223.89 619.34L224.01 621.48L223.07 624.57L222.26 626.03L221.23 626.83L219.63 631.12L219.26 633.35L222.04 636.49L225.4 641.78L227.11 649.22L226.23 649.47L205.62 649.76L202.66 650.24L198 650.3L194.83 648.21L189.12 640.74L181.48 635.26L174.14 632.49L173.48 633.37L170.7 646.25L169.91 648.51L167.97 650.66L154.3 654.73L150.65 654.96L148.24 656.66L146.49 664.65L146.32 667.47L138.67 670.24L133.82 672.73L134.32 678.72L128.68 683.36L125.7 688.91L105.75 693.24L94.95 691.98L90.76 689.26L90.37 682.99L92.1 674.41L87.92 660.6L88.41 659.17L88.43 657.29L87.33 650.01L85.9 647.61L84.68 646.89L80.23 642.27L80.11 635.85L79.22 630.58L77.53 626.36L75.14 623.27L75.01 606.42L63.14 587.17L59.02 587.11L57.71 586.5L56.28 584.63L56 583.49L56.03 576.17L57.85 573.7L60.71 571.72L60.97 570.64L59.69 569.26L56.82 567.26L52.78 565.72L49.68 563.92L47.98 562.09L46.59 559.58L46.46 556.88L47.46 555.74L49.04 554.98L48.16 549.63L45.87 544.21L44.95 543.04L45.33 541.69L51.72 539.95L55.39 539.79L58.13 532.47L55.93 528.07L49.74 523.21L49.87 521.14L55.65 513.84L68.11 518.4L84.2 523.54L98.35 528.59L100.24 528.25L107.12 525.34L150.26 506.47L152.41 505.07L159.36 498.5L163.38 496.18L166.83 495.6L170.34 495.69L181.09 494.8L182.52 494.38L183.39 493.2L183.22 492.12L177.69 485.69L175.35 482.27L173.92 479.03L171.51 471.61L170.11 470.47L167.28 469.55L164.57 469.46L158.87 467.27L153.61 462.95L152.75 461.79L150.5 456.7L151.17 449.52L154.4 447.25L156.26 446.59L158.34 445.31L158.78 444.12L154.85 443.19L151.8 443.65L148.76 442.41L147.79 441.14L147.51 438.85L148.01 434.24L148.88 433.43L153.14 431.96L153.87 430.43L162.4 429.99L166.5 430.45L168.12 430.19L176.09 424.06L180.44 423.14L183.42 423.55L184.43 424.11L185.85 426.82L188.81 430.22L191.57 429.6L195.1 431.27L200.17 434.96L203.43 438.06L207.33 443.27L211.73 448.12L218.29 453.23L217.13 453.74L212.99 452.39L202.31 449.78L201.91 453.9L203.95 458.79L205.19 465.64L213.51 467.05L214.45 467.91L214.56 468.97L214.19 470.1L210.22 473.95L210.66 480.4L208.59 484.6L209.7 487.96L216.15 495.77L216.64 497.4L220.65 500.1L228.5 503.7L233.43 503.92L234.91 502.93L236.18 502.59L239.98 502.91L242.84 505.39L244.6 509.68L244.41 512L245.81 516.8L249.15 521.83L246.52 525.67L241.03 531.05L233.92 534.97L232.04 535.5L228.79 535.65L224.29 536.46L219.64 539.27L217.15 548.1L217.31 551.17L220.88 565.47L220.12 568.38L216.88 574.96L214.31 582.38L213.66 590.25L212.1 594.98L211.7 604.84L211.87 606.59L213.17 609.37L219.11 615.39L223.89 619.34Z"/>
                <path id="SantaCruz" data-name="Santa Cruz" d="M533.58 502.26L488.9 499.5L457.05 508.12L400.11 518.01L391.5 541.2L377.09 562.12L322.07 562.32L315.59 558.61L311.12 561.62L303.49 560.97L302.65 560.27L301.85 546.23L301.9 542.09L301.45 538.29L299.91 534.09L299.83 523.05L297.92 497.23L299.3 486.08L292.01 485.98L291.24 486.88L290.96 490.72L290.3 492.01L289.31 492.9L288.24 493.12L285.98 492.69L283.86 488.02L272.05 474.68L270.33 470.35L270.2 466.85L268.93 466.04L271.5 462.36L270.92 457.27L267 454.19L265.5 453.64L264.75 452.87L262.01 444.12L254.2 431.41L250.55 427.37L250.41 425.59L250.81 424.43L253.78 421.99L257.13 418.49L265.23 406.72L265.96 405.24L266 402.67L268.99 400.41L275.15 400.38L275.38 396.64L274.86 395.58L269.14 388.63L266.64 386.63L251.1 376.48L247.46 369.21L246.86 367.28L246.67 362.85L248.58 358.02L250.99 353.96L254.02 345.36L252.98 334.27L252.02 328.87L250.95 325.88L250.62 321.49L251.78 318.04L255.81 318.96L260.93 319.29L316.4 321.56L317.83 320.71L314.34 313.76L312.16 310.44L305.17 306.68L302.56 304.1L292.97 289.38L289.62 281.94L288.49 277.89L289.53 266.36L288.44 261.58L287.81 260.15L307.07 254.79L407.62 196.85L408.43 197.82L411.27 199.08L412.7 199.23L435.59 196.12L437.34 198.58L439.68 200.75L448.06 205.73L450.45 205.88L453.91 208.78L463.94 212.13L468.59 221.62L467.78 223.81L466.51 225.74L464.54 227.53L463.68 230.95L465.26 237.32L466.43 239.04L473.81 254.51L474.93 278.9L459.17 279.1L476.52 298.9L479.9 339.78L566.7 343.26L567.92 342.75L569.24 340.81L572.33 340.62L572.49 346.73L571.38 352.47L567.7 356L565.25 359.69L564.85 361.29L565.48 373.12L567.44 378.84L568.3 384.2L568.2 388.32L569.16 391.94L570.13 392.96L574 394.05L576.24 395.44L582.77 399.99L583.36 401.36L584.23 402.23L588.01 404.44L589.68 404.61L593.81 402.57L601.68 409.51L600.66 410.5L599.97 411.81L600.99 414.4L603.11 416.54L603.03 422.72L613 441.64L611.42 443.9L610.87 445.38L600.43 478.77L602.82 479.17L603.74 486.06L600.11 486.27L582.74 523.14L596.32 535.62L593.85 538.48L583.32 544.89L580.84 545.9L581.93 543.14L582.14 541.32L582.23 536.19L581.24 527.92L575.33 524.36L533.58 502.26Z"/>
                <path id="Tarija" data-name="Tarija" d="M354.65 657.28L353.97 657.13L348.54 652.72L347.16 650.59L346.74 645.27L345.91 644.2L289.23 644.39L286.61 649.46L279.87 666.57L277.55 669.83L275.01 672.14L273.48 675.11L272.14 679.34L271.94 685.26L271.06 689.5L270.3 691.03L269.2 691.53L268.7 690.08L268.48 685.95L267.95 684.31L263.4 679.25L263.29 677.71L263.87 675.78L262.96 672.22L259.72 666.49L258.67 658.45L256.37 655.89L251.78 653.84L250.16 654.2L237.36 650.17L236.41 649.26L226.23 649.47L227.11 649.22L225.4 641.78L222.04 636.49L219.26 633.35L219.63 631.12L221.23 626.83L222.26 626.03L223.07 624.57L224.01 621.48L223.89 619.34L226.98 589.08L227.75 587.51L231.89 588L240.24 592.26L242.38 594.48L244.3 595.41L246.92 594.86L248.03 592.28L248.4 589.68L250.26 586.74L253.66 587.35L257.4 591.56L261.3 595.07L267.9 597.73L274.52 598.22L275.52 597.57L276.21 596.38L277.01 591.72L276.91 586.01L277.44 584.64L282.74 586.06L284.11 587.98L287.43 590.33L335.17 590.65L373.95 590.48L374.06 593.52L354.65 657.28Z"/>
            `;

            const bounds = L.latLngBounds(
                L.latLng(-22.5, -69.5),
                L.latLng(-9.5, -57.5)
            );

            const svgOverlay = L.svgOverlay(svgElement, bounds, {
                opacity: 0.6,
                interactive: true
            }).addTo(map);

            let isLayerVisible = true;

            const opacitySlider = document.getElementById('opacitySlider');
            const opacityValue = document.getElementById('opacityValue');
            const strokeSlider = document.getElementById('strokeSlider');
            const strokeValue = document.getElementById('strokeValue');
            const toggleBtn = document.getElementById('toggleLayer');

            opacitySlider.addEventListener('input', function(e) {
                const opacity = e.target.value / 100;
                opacityValue.textContent = e.target.value + '%';
                svgOverlay.setOpacity(opacity);
            });

            strokeSlider.addEventListener('input', function(e) {
                const stroke = e.target.value;
                strokeValue.textContent = stroke + 'px';
                const paths = document.querySelectorAll('#boliviaOverlay path');
                paths.forEach(function(path) {
                    path.style.strokeWidth = stroke;
                });
            });

            toggleBtn.addEventListener('click', function() {
                if (isLayerVisible) {
                    svgOverlay.setOpacity(0);
                    map.removeLayer(huellaLayerGroup);
                    toggleBtn.textContent = 'Mostrar Capa SVG';
                } else {
                    svgOverlay.setOpacity(opacitySlider.value / 100);
                    map.addLayer(huellaLayerGroup);
                    toggleBtn.textContent = 'Ocultar Capa SVG';
                }
                isLayerVisible = !isLayerVisible;
            });

            // Cargar huellas existentes al iniciar
            cargarHuellasExistentes();

            setTimeout(function() {
                const paths = document.querySelectorAll('#boliviaOverlay path');
                
                paths.forEach(function(path) {
                    path.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const deptName = this.getAttribute('data-name');
                        
                        const clickX = e.clientX;
                        const clickY = e.clientY;
                        
                        const clickLatLng = map.containerPointToLatLng([clickX, clickY]);
                        currentClickCoords = clickLatLng;
                        
                        showDeptPopup(deptName, clickX, clickY, clickLatLng);
                        
                        paths.forEach(p => p.classList.remove('selected'));
                        this.classList.add('selected');
                    });
                });
            }, 500);

            document.addEventListener('click', function(e) {
                if (!e.target.closest('.dept-popup') && !e.target.closest('#boliviaOverlay path')) {
                    closeDeptPopup();
                }
            });
        });

        // Cargar huellas existentes desde la base de datos
        async function cargarHuellasExistentes() {
            try {
                const response = await fetch(`${API_BASE}/huellas`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const huellas = await response.json();
                
                huellas.forEach(huella => {
                    createHuellaIcon(huella.apodo, huella.lat, huella.lng);
                    
                    // Marcar departamento como visitado
                    const path = document.querySelector(`path[data-name="${huella.departamento}"]`);
                    if (path) {
                        path.classList.add('visitado');
                    }
                });
                
                console.log(`üìä Cargadas ${huellas.length} huellas existentes`);
            } catch (error) {
                console.error('Error al cargar huellas existentes:', error);
                // Fallback a localStorage si el servidor no est√° disponible
                cargarHuellasDesdeLocalStorage();
            }
        }

        function showDeptPopup(deptName, x, y, latLng) {
            const popup = document.getElementById('deptPopup');
            
            const lat = latLng.lat.toFixed(6);
            const lng = latLng.lng.toFixed(6);
            
            popup.innerHTML = `
                <div class="popup-header">
                    <h3>${deptName}</h3>
                    <button class="popup-close" onclick="closeDeptPopup()">√ó</button>
                </div>
                <div class="coordinates-box">
                    <h4>üìç Coordenadas del Clic</h4>
                    <div class="coord-item">
                        <span class="coord-label">Latitud:</span>
                        <span>${lat}¬∞</span>
                    </div>
                    <div class="coord-item">
                        <span class="coord-label">Longitud:</span>
                        <span>${lng}¬∞</span>
                    </div>
                    <div class="coord-item">
                        <span class="coord-label">Formato:</span>
                        <span>${lat}, ${lng}</span>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-huella" onclick="dejarHuella('${deptName}')">
                        üë£ Dejar Huella
                    </button>
                    <button class="btn btn-trivia" onclick="openTrivia('${deptName}')">
                        üéØ Trivia NASA
                    </button>
                </div>
            `;
            
            popup.style.left = x + 'px';
            popup.style.top = y + 'px';
            popup.classList.add('active');
            
            setTimeout(() => {
                const popupRect = popup.getBoundingClientRect();
                if (popupRect.right > window.innerWidth) {
                    popup.style.left = (x - popupRect.width - 10) + 'px';
                }
                if (popupRect.bottom > window.innerHeight) {
                    popup.style.top = (y - popupRect.height - 10) + 'px';
                }
            }, 10);
        }

        function closeDeptPopup() {
            document.getElementById('deptPopup').classList.remove('active');
        }

        function dejarHuella(deptName) {
            currentDepartment = deptName;
            document.getElementById('deptName').textContent = deptName;
            document.getElementById('huellaModal').classList.add('active');
            closeDeptPopup();
        }

        function closeHuellaForm() {
            document.getElementById('huellaModal').classList.remove('active');
            document.getElementById('huellaForm').reset();
            currentDepartment = null;
        }

        function createHuellaIcon(nick, lat, lng) {
            const huellaIcon = L.divIcon({
                className: 'huella-icon',
                html: `<i class="fas fa-footprint"></i>`,
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });

            const marker = L.marker([lat, lng], {
                icon: huellaIcon,
                zIndexOffset: 1000
            }).addTo(huellaLayerGroup);

            marker.bindTooltip(nick, {
                permanent: false,
                direction: 'top',
                offset: [0, -10],
                className: 'huella-tooltip'
            });

            huellaMarkers.push(marker);
            return marker;
        }

        // Funci√≥n modificada para enviar datos al servidor
        async function submitHuella(event) {
            event.preventDefault();
            
            const nick = document.getElementById('userNick').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            
            if (!nick || !email) {
                alert('Por favor, completa todos los campos');
                return;
            }

            const huellaData = {
                correo: email,
                apodo: nick,
                departamento: currentDepartment,
                lat: currentClickCoords.lat,
                lng: currentClickCoords.lng
            };

            try {
                const response = await fetch(`${API_BASE}/huella`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(huellaData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                // √âxito: crear marcador en el mapa
                createHuellaIcon(nick, currentClickCoords.lat, currentClickCoords.lng);
                
                // Marcar departamento como visitado
                const path = document.querySelector(`path[data-name="${currentDepartment}"]`);
                if (path) {
                    path.classList.add('visitado');
                }
                
                // Guardar tambi√©n en localStorage como backup
                guardarHuellaEnLocalStorage(huellaData);
                
                alert(`‚úÖ ¬°Huella registrada exitosamente!\n\nNick: ${nick}\nDepartamento: ${currentDepartment}`);
                
                closeHuellaForm();
            } catch (error) {
                console.error('Error:', error);
                // Fallback a localStorage
                guardarHuellaEnLocalStorage(huellaData);
                alert(`!Alerta¬° ¬°Nombre o correos ya guardados!\n\n(Error del servidor: ${error.message})`);
                closeHuellaForm();
            }
        }

        // Funciones de backup para localStorage
        function cargarHuellasDesdeLocalStorage() {
            try {
                const huellasGuardadas = localStorage.getItem('huellasBolivia');
                if (huellasGuardadas) {
                    const huellas = JSON.parse(huellasGuardadas);
                    huellas.forEach(huella => {
                        createHuellaIcon(huella.apodo, huella.lat, huella.lng);
                        const path = document.querySelector(`path[data-name="${huella.departamento}"]`);
                        if (path) path.classList.add('visitado');
                    });
                    console.log(`üìä Cargadas ${huellas.length} huellas desde localStorage`);
                }
            } catch (error) {
                console.error('Error cargando de localStorage:', error);
            }
        }

        function guardarHuellaEnLocalStorage(huellaData) {
            try {
                const huellasExistentes = JSON.parse(localStorage.getItem('huellasBolivia') || '[]');
                huellaData.id = Date.now();
                huellasExistentes.push(huellaData);
                localStorage.setItem('huellasBolivia', JSON.stringify(huellasExistentes));
            } catch (error) {
                console.error('Error guardando en localStorage:', error);
            }
        }

        function openTrivia(deptName) {
            const modal = document.getElementById('triviaModal');
            const container = document.getElementById('triviaContainer');
            
            const questions = triviaData[deptName];
            if (!questions) {
                alert('No hay trivia disponible para este departamento.');
                return;
            }
            
            let score = 0;
            let currentQuestion = 0;
            
            function renderQuestion() {
                if (currentQuestion >= questions.length) {
                    container.innerHTML = `
                        <div class="trivia-header">
                            <h3>üéä ¬°Trivia Completada!</h3>
                            <button class="close-btn" onclick="closeTrivia()">√ó</button>
                        </div>
                        <div class="trivia-score">
                            Tu puntuaci√≥n: ${score}/${questions.length}
                            <br><br>
                            ${score === questions.length ? 'üèÜ ¬°Perfecto! Eres un experto en Terra NASA' : 
                              score >= questions.length * 0.7 ? 'üåü ¬°Muy bien! Conoces los datos satelitales' :
                              'üìö Sigue aprendiendo sobre Terra'}
                        </div>
                    `;
                    return;
                }
                
                const q = questions[currentQuestion];
                
                container.innerHTML = `
                    <div class="trivia-header">
                        <h3>üõ∞Ô∏è Trivia Terra NASA - ${deptName}</h3>
                        <button class="close-btn" onclick="closeTrivia()">√ó</button>
                    </div>
                    <div class="trivia-question">
                        <h4>Pregunta ${currentQuestion + 1} de ${questions.length}</h4>
                        <p style="margin: 15px 0; font-size: 15px; line-height: 1.6;">${q.pregunta}</p>
                        <div class="trivia-options" id="triviaOptions">
                            ${q.opciones.map((opcion, index) => `
                                <div class="trivia-option" data-index="${index}">
                                    ${opcion}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px; color: #666;">
                        Puntuaci√≥n: ${score}/${questions.length}
                    </div>
                `;
                
                const options = container.querySelectorAll('.trivia-option');
                options.forEach(option => {
                    option.addEventListener('click', function() {
                        const selectedIndex = parseInt(this.dataset.index);
                        const isCorrect = selectedIndex === q.correcta;
                        
                        if (isCorrect) {
                            score++;
                            this.classList.add('correct');
                        } else {
                            this.classList.add('incorrect');
                            options[q.correcta].classList.add('correct');
                        }
                        
                        options.forEach(opt => opt.classList.add('disabled'));
                        
                        setTimeout(() => {
                            currentQuestion++;
                            renderQuestion();
                        }, 1500);
                    });
                });
            }
            
            renderQuestion();
            modal.classList.add('active');
            closeDeptPopup();
        }

        function closeTrivia() {
            document.getElementById('triviaModal').classList.remove('active');
        }
    </script>
</body>
</html>
